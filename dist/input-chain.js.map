{"version":3,"file":"input-chain.js","sourceRoot":"","sources":["../src/input-chain.ts"],"names":[],"mappings":";;;;;;AAAA,OAAO,EAAC,UAAU,EAAE,IAAI,EAAC,MAAM,KAAK,CAAA;AACpC,OAAO,EAAC,aAAa,EAAE,QAAQ,EAAC,MAAM,mBAAmB,CAAA;AACzD,OAAO,EAAE,gBAAgB,EAAE,MAAM,aAAa,CAAA;AAE9C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;GA6BG;AAGI,IAAM,UAAU,GAAhB,MAAM,UAAW,SAAQ,UAAU;IAiBxC;QACE,KAAK,EAAE,CAAA;QAfT;;;WAGG;QAEH,QAAG,GAAG,EAAE,CAAA;QAER;;;WAGG;QAEH,SAAI,GAAG,EAAE,CAAA;QAMT;;;WAGG;QACO,UAAK,GAA2B,IAAI,CAAA;QAsBtC,eAAU,GAAG,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,CAAA;QAE9C;;WAEG;QACO,eAAU,GAAG,CAAC,KAAoB,EAAE,EAAE;YAC9C,IAAG,CAAC,IAAI,CAAC,IAAI,EAAE;gBACb,MAAM,IAAI,KAAK,CAAC,4CAA4C,CAAC,CAAA;aAC9D;YACD,IAAI,CAAC,OAAO;iBACX,MAAM,CAAC,MAAM,CAAC,EAAE,CAAC,MAAM,CAAC,QAAQ,CAAC;iBACjC,OAAO,CAAC,MAAM,CAAC,EAAE;gBAChB,KAAK,CAAC,QAAQ,CAAC,MAAM,CAAC,IAAI,CAAC,IAAI,EAAE,MAAM,CAAC,KAAK,CAAC,CAAA;YAChD,CAAC,CAAC,CAAA;QACJ,CAAC,CAAA;IA1CD,CAAC;IAOD,IAAc,IAAI,CAAC,OAA+B;QAChD,IAAG,IAAI,CAAC,KAAK,EAAE;YACb,IAAI,CAAC,KAAK,CAAC,mBAAmB,CAAC,UAAU,EAAE,IAAI,CAAC,UAAU,CAAC,CAAA;SAC5D;QACD,IAAG,OAAO,EAAE;YACV,OAAO,CAAC,gBAAgB,CAAC,UAAU,EAAE,IAAI,CAAC,UAAU,CAAC,CAAA;SACtD;IACH,CAAC;IACD,IAAc,IAAI;QAChB,OAAO,IAAI,CAAC,KAAK,CAAA;IACnB,CAAC;IAED;;;OAGG;IAEH,IAAI,OAAO;QACT,OAAO,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,gBAAgB,CAAC,uBAAuB,CAAC,CAAC,CAAA;IACnE,CAAC;IAkBD;;OAEG;IACM,MAAM;QACb,OAAO,IAAI,CAAA;;KAEV,CAAA;IACH,CAAC;IAEQ,iBAAiB;QACxB,KAAK,CAAC,iBAAiB,EAAE,CAAA;QACzB,+BAA+B;QAC/B,IAAG,IAAI,CAAC,GAAG,EAAE;YACX,MAAM,IAAI,GAAG,QAAQ,CAAC,aAAa,CAAkB,QAAQ,IAAI,CAAC,GAAG,EAAE,CAAC,CAAA;YACxE,IAAG,IAAI,EAAE;gBACP,IAAI,CAAC,IAAI,GAAG,IAAI,CAAA;aACjB;SACF;aAAM;YACL,IAAI,CAAC,IAAI,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,CAAA;SACjC;QACD,0BAA0B;QAC1B,IAAI,CAAC,UAAW,CAAC,gBAAgB,CAAC,QAAQ,EAAE,IAAI,CAAC,UAAU,CAAC,CAAA;IAC9D,CAAC;IAEQ,oBAAoB;QAC3B,IAAI,CAAC,mBAAmB,CAAC,QAAQ,EAAE,IAAI,CAAC,UAAU,CAAC,CAAA;QACnD,IAAI,CAAC,IAAI,GAAG,IAAI,CAAA;QAChB,KAAK,CAAC,oBAAoB,EAAE,CAAA;IAC9B,CAAC;IAED;;;OAGG;IACK,SAAS,CAAC,KAAY;QAC5B,MAAM,MAAM,GAAG,KAAK,CAAC,MAA0B,CAAA;QAC/C,IAAG,MAAM,CAAC,aAAa,KAAK,IAAI,EAAE;YAChC,MAAM,IAAI,KAAK,CAAC,+CAA+C,CAAC,CAAA;SACjE;QACD,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,OAAO,CAAC,MAAM,CAAC,CAAC,CAAA;QACxD,yBAAyB;QACzB,KAAK,CAAC,cAAc,EAAE,CAAA;QACtB,KAAK,CAAC,wBAAwB,EAAE,CAAA;QAChC,IAAI,CAAC,aAAa,CAAC,IAAI,KAAK,CAAC,QAAQ,CAAC,CAAC,CAAA;QACvC,IAAI,CAAC,aAAa,EAAE,CAAA;IACtB,CAAC;IAED;;OAEG;IACO,QAAQ,CAAC,GAAW;QAC5B,MAAM,QAAQ,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,QAAQ,CAAkB,CAAA;QAC3D,MAAM,MAAM,GAAG,GAAG,IAAI,CAAC,CAAC,CAAC,CAAC,QAAQ,CAAC,GAAG,CAAqB,CAAC,CAAC,CAAC,IAAI,CAAA;QAClE,MAAM,IAAI,GAA4B,CAAA,MAAM,aAAN,MAAM,uBAAN,MAAM,CAAE,KAAK,EAAC,CAAC,CAAC,MAAM,CAAC,kBAAsC,CAAC,CAAC,CAAC,MAAM,IAAI,QAAQ,CAAC,CAAC,CAAqB,CAAA;QAC/I,IAAG,IAAI,EAAE;YACP,MAAM,SAAS,GAAG,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,CAAA;YACxC,iCAAiC;YACjC,QAAQ,CAAC,KAAK,CAAC,SAAS,GAAG,CAAC,CAAC;iBAC1B,OAAO,CAAC,KAAK,CAAC,EAAE,CAAC,KAAK,CAAC,MAAM,EAAE,CAAC,CAAA;YACnC,aAAa;YACb,IAAI,CAAC,KAAK,GAAG,EAAE,CAAA;SAChB;IACH,CAAC;;AA5He,iBAAM,GAAG,gBAAgB,AAAnB,CAAmB;AAOzC;IADC,QAAQ,CAAC,EAAC,IAAI,EAAE,MAAM,EAAE,SAAS,EAAE,KAAK,EAAC,CAAC;uCACnC;AAOR;IADC,QAAQ,CAAC,EAAC,IAAI,EAAE,MAAM,EAAC,CAAC;wCAChB;AA4BT;IADC,QAAQ,CAAC,EAAC,IAAI,EAAE,KAAK,EAAC,CAAC;yCAGvB;AA7CU,UAAU;IADtB,aAAa,CAAC,aAAa,CAAC;GAChB,UAAU,CA8HtB","sourcesContent":["import {LitElement, html} from 'lit'\nimport {customElement, property} from 'lit/decorators.js'\nimport { inputChainStyles } from './styles.js'\n\n/**\n * @element input-chain\n * Web component to select a sequence of steps, each step being a <select> element.\n * \n * Children are expected to be input or select html elements\n * \n * Features\n * - Nested Select Elements: Allows embedding <select> elements as children.\n * - Dynamic Interaction: Automatically updates subsequent select elements upon a change in any select element, resetting them to a default state.\n * - Event Handling: Emits change events whenever the value of a child select element changes.\n * - Validation Support: Supports form validation attributes like required, minlength, and maxlength.\n * - Combined Options Property: Holds a property with a concatenation of all options from child select elements.\n * - Supports option groups: Allows grouping options in the same select element.\n * \n * It has these events:\n * - [x] change\n * \n * It has these attributes:\n * - [x] name for form submission\n * - [x] for (form id)\n * - [ ] maxlength\n * - [ ] minlength\n * \n * It has these properties:\n * - [x] options: a concatenation of all options from child select elements\n * \n * It has these slots:\n * - [x] default: contains the select elements\n * \n */\n\n@customElement('input-chain')\nexport class InputChain extends LitElement {\n  static override styles = inputChainStyles\n\n  /**\n   * Form id\n   * This is the same API as input elements\n   */\n  @property({type: String, attribute: 'for'})\n  for = ''\n\n  /**\n   * Name of the property\n   * This is the same API as input elements\n   */\n  @property({type: String})\n  name = ''\n\n  constructor() {\n    super()\n  }\n\n  /**\n   * Form setter\n   * Handle formdata event to add the current value to the form\n   */\n  protected _form: HTMLFormElement | null = null\n  protected set form(newForm: HTMLFormElement | null) {\n    if(this._form) {\n      this._form.removeEventListener('formdata', this.onFormdata)\n    }\n    if(newForm) {\n      newForm.addEventListener('formdata', this.onFormdata)\n    }\n  }\n  protected get form() {\n    return this._form\n  }\n\n  /**\n   * All selected options\n   * @readonly\n   */\n  @property({type: Array})\n  get options(): HTMLOptionElement[] {\n    return Array.from(this.querySelectorAll('option, custom-option'))\n  }\n\n  private onChanged_ = this.onChanged.bind(this)\n\n  /**\n   * Handle formdata event to add the current value to the form\n   */\n  protected onFormdata = (event: FormDataEvent) => {\n    if(!this.name) {\n      throw new Error('Attribute name is required for input-chain')\n    }\n    this.options\n    .filter(option => option.selected)\n    .forEach(option => {\n      event.formData.append(this.name, option.value)\n    })\n  }\n\n  /**\n   * Render the component\n   */\n  override render() {\n    return html`\n      <slot></slot>\n    `\n  }\n\n  override connectedCallback() {\n    super.connectedCallback()\n    // Use the form to add formdata\n    if(this.for) {\n      const form = document.querySelector<HTMLFormElement>(`form#${this.for}`)\n      if(form) {\n        this.form = form\n      }\n    } else {\n      this.form = this.closest('form')\n    }\n    // Listen to slots changes\n    this.shadowRoot!.addEventListener('change', this.onChanged_)\n  }\n\n  override disconnectedCallback() {\n    this.removeEventListener('change', this.onChanged_)\n    this.form = null\n    super.disconnectedCallback()\n  }\n\n  /**\n   * The data changed\n   * Reset the steps after the change\n   */\n  private onChanged(event: Event) {\n    const target = event.target as HTMLInputElement\n    if(target.parentElement !== this) {\n      throw new Error('Changed element is not a child of input-chain')\n    }\n    this.changeAt(Array.from(this.children).indexOf(target))\n    // Dispatch our own event\n    event.preventDefault()\n    event.stopImmediatePropagation()\n    this.dispatchEvent(new Event('change'))\n    this.requestUpdate()\n  }\n\n  /**\n   * Reset the steps after the given index\n   */\n  protected changeAt(idx: number) {\n    const children = Array.from(this.children) as HTMLElement[]\n    const target = idx >= 0 ? children[idx] as HTMLInputElement : null\n    const next: HTMLInputElement | null = target?.value ? target.nextElementSibling as HTMLInputElement : target || children[0] as HTMLInputElement\n    if(next) {\n      const nextIndex = children.indexOf(next)\n      // Remove all elements after next\n      children.slice(nextIndex + 1)\n        .forEach(child => child.remove())\n      // Reset next\n      next.value = ''\n    }\n  }\n}\n\ndeclare global {\n  interface HTMLElementTagNameMap {\n    'input-chain': InputChain\n  }\n}\n\n"]}